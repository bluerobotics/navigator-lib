<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Interface for the I2C peripheral."><title>rppal::i2c - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Bold-a2c9cd1067f8b328.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-cb6f1f67f1bcd037.css" id="mainThemeStyle"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="rppal" data-themes="" data-resource-suffix="" data-rustdoc-version="1.73.0-nightly (8131b9774 2023-08-02)" data-channel="nightly" data-search-js="search-6dfdfced5eff6596.js" data-settings-js="settings-de11bff964e9d4e5.js" data-settings-css="settings-8c76f75bfb6bd192.css" data-theme-light-css="light-6d2c9675f3d09c26.css" data-theme-dark-css="dark-45ceb8f2e522f4d1.css" data-theme-ayu-css="ayu-fd19013d6ce078bf.css" ><script src="../../static.files/storage-db41da1a38ea3cb8.js"></script><script defer src="../../static.files/main-0795b7d26be81095.js"></script><noscript><link rel="stylesheet" media="(prefers-color-scheme:light)" href="../../static.files/light-6d2c9675f3d09c26.css"><link rel="stylesheet" media="(prefers-color-scheme:dark)" href="../../static.files/dark-45ceb8f2e522f4d1.css"><link rel="stylesheet" href="../../static.files/noscript-cffde32267a19fd6.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="logo-container" href="../../rppal/index.html"><img class="rust-logo" src="../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2></h2></nav><nav class="sidebar"><a class="logo-container" href="../../rppal/index.html"><img class="rust-logo" src="../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2 class="location"><a href="#">Module i2c</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#types">Type Definitions</a></li></ul></section></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Module <a href="../index.html">rppal</a>::<wbr><a class="mod" href="#">i2c</a><button id="copy-path" title="Copy item path to clipboard"><img src="../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="src" href="../../src/rppal/i2c.rs.html#21-707">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Interface for the I2C peripheral.</p>
<p>The Broadcom Serial Controller (BSC) peripheral controls a proprietary bus
compliant with the I2C bus/interface. RPPAL communicates with the BSC
using the <code>i2cdev</code> device interface.</p>
<h3 id="i2c-buses"><a href="#i2c-buses">I2C buses</a></h3>
<p>The Raspberry Pi 3 B+ and earlier models support three hardware I2C buses,
however only the I2C bus on physical pins 3 and 5 should be used to communicate
with slave devices. The other two buses are used internally as an HDMI
interface, and for HAT identification.</p>
<p>On the Raspberry Pi 4 B and 400, three additional I2C buses are available,
depending on your configuration, as explained below.</p>
<h4 id="i2c0--i2c1"><a href="#i2c0--i2c1">I2C0 / I2C1</a></h4>
<p>On the Raspberry Pi B Rev 1, physical pins 3 (SDA) and 5 (SCL) are tied to I2C0.
On every other Raspberry Pi model, they’re connected to I2C1.</p>
<p>The I2C bus connected to these pins is disabled by
default. You can enable it through <code>sudo raspi-config</code>, or by manually
adding <code>dtparam=i2c_arm=on</code> to <code>/boot/config.txt</code>. Remember to reboot
the Raspberry Pi afterwards.</p>
<ul>
<li>SDA: BCM GPIO 2 (physical pin 3)</li>
<li>SCL: BCM GPIO 3 (physical pin 5)</li>
</ul>
<h4 id="i2c3"><a href="#i2c3">I2C3</a></h4>
<p>I2C3 can be enabled by adding <code>dtoverlay=i2c3</code> to <code>/boot/config.txt</code>.</p>
<ul>
<li>SDA: BCM GPIO 4 (physical pin 7)</li>
<li>SCL: BCM GPIO 5 (physical pin 29)</li>
</ul>
<h4 id="i2c4"><a href="#i2c4">I2C4</a></h4>
<p>I2C4 can be enabled by adding <code>dtoverlay=i2c4</code> to <code>/boot/config.txt</code>.</p>
<ul>
<li>SDA: BCM GPIO 8 (physical pin 24)</li>
<li>SCL: BCM GPIO 9 (physical pin 21)</li>
</ul>
<h4 id="i2c5"><a href="#i2c5">I2C5</a></h4>
<p>I2C5 can be enabled by adding <code>dtoverlay=i2c5</code> to <code>/boot/config.txt</code>.</p>
<ul>
<li>SDA: BCM GPIO 12 (physical pin 32)</li>
<li>SCL: BCM GPIO 13 (physical pin 33)</li>
</ul>
<h4 id="i2c6"><a href="#i2c6">I2C6</a></h4>
<p>I2C6 can be enabled by adding <code>dtoverlay=i2c6</code> to <code>/boot/config.txt</code>.</p>
<ul>
<li>SDA: BCM GPIO 22 (physical pin 15)</li>
<li>SCL: BCM GPIO 23 (physical pin 16)</li>
</ul>
<h4 id="alternative-pins"><a href="#alternative-pins">Alternative pins</a></h4>
<p>The GPIO pin numbers mentioned above are part of the default configuration.
Some of their functionality can be moved to different pins. Read
<code>/boot/overlays/README</code> for more information.</p>
<h4 id="software-i2c"><a href="#software-i2c">Software I2C</a></h4>
<p>In addition to the hardware I2C buses, it’s possible to configure a
bit-banged software I2C bus on any available GPIO pins through the <code>i2c-gpio</code>
device tree overlay. More details on enabling and configuring <code>i2c-gpio</code>
can be found in <code>/boot/overlays/README</code>.</p>
<h3 id="transmission-speed"><a href="#transmission-speed">Transmission speed</a></h3>
<p>The BSC supports I2C data transfer rates up to 400 kbit/s (Fast-mode).</p>
<p>By default, the I2C bus clock speed is set to 100 kHz. Transferring
1 bit takes 1 clock cycle. You can change the
transfer rate by adding <code>dtparam=i2c_arm_baudrate=X</code> to
<code>/boot/config.txt</code>, where <code>X</code> should be replaced with the
clock frequency in hertz (Hz). Remember to reboot
the Raspberry Pi afterwards.</p>
<h3 id="not-supported"><a href="#not-supported">Not supported</a></h3>
<p>Some I2C and SMBus features aren’t fully supported by the <code>i2cdev</code> interface, the underlying driver or
the BCM283x SoC: 10-bit slave addresses, SMBus Block Read, SMBus Block Process Call, SMBus Host Notify,
SMBus Read/Write 32/64, and the SMBus Address Resolution Protocol.</p>
<p>While clock stretching is supported, a bug exists in the implementation on the BCM283x SoC that will result
in corrupted data when a slave device uses clock stretching at arbitrary points during the transfer.
Clock stretching only works properly during read operations, directly after the ACK phase, when the additional
delay is longer than half of a clock period. More information can be found <a href="https://elinux.org/BCM2835_datasheet_errata#p35_I2C_clock_stretching">here</a>.</p>
<p>A possible workaround for slave devices that require clock stretching at other points during the transfer is
to use a bit-banged software I2C bus by configuring the <code>i2c-gpio</code> device tree overlay as described in <code>/boot/overlays/README</code>.</p>
<h3 id="troubleshooting"><a href="#troubleshooting">Troubleshooting</a></h3><h4 id="permission-denied"><a href="#permission-denied">Permission denied</a></h4>
<p>If <a href="struct.I2c.html#method.new"><code>new</code></a> or <a href="struct.I2c.html#method.with_bus"><code>with_bus</code></a> returns an <code>io::ErrorKind::PermissionDenied</code>
error, make sure the file permissions for <code>/dev/i2c-1</code> or <code>/dev/i2c-0</code>
are correct, and the current user is a member of the <code>i2c</code> group.</p>
<h4 id="timed-out"><a href="#timed-out">Timed out</a></h4>
<p>Transactions return an <code>io::ErrorKind::TimedOut</code> error when their duration
exceeds the timeout value. You can change the timeout using <a href="struct.I2c.html#method.set_timeout"><code>set_timeout</code></a>.</p>
</div></details><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.Capabilities.html" title="struct rppal::i2c::Capabilities">Capabilities</a></div><div class="desc docblock-short">Lists the features supported by the underlying drivers.</div></li><li><div class="item-name"><a class="struct" href="struct.I2c.html" title="struct rppal::i2c::I2c">I2c</a></div><div class="desc docblock-short">Provides access to the Raspberry Pi’s I2C peripheral.</div></li></ul><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2><ul class="item-table"><li><div class="item-name"><a class="enum" href="enum.Error.html" title="enum rppal::i2c::Error">Error</a></div><div class="desc docblock-short">Errors that can occur when accessing the I2C peripheral.</div></li></ul><h2 id="types" class="small-section-header"><a href="#types">Type Definitions</a></h2><ul class="item-table"><li><div class="item-name"><a class="type" href="type.Result.html" title="type rppal::i2c::Result">Result</a></div><div class="desc docblock-short">Result type returned from methods that can have <code>i2c::Error</code>s.</div></li></ul></section></div></main></body></html>